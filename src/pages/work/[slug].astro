---
import { Icon } from 'astro-icon/components'
import { getCollection } from 'astro:content'
import Layout from '../../layouts/Layout.astro'

export async function getStaticPaths() {
  const allPosts = await getCollection('work')

  return allPosts.map((post) => ({
    params: {
      slug: post.slug,
    },
    props: {
      allPosts,
      post,
    },
  }))
}

const { post, allPosts } = Astro.props
const currentPostID = +post.data.id
const prevPost = allPosts.find((p) => +p.data.id === currentPostID + 1)
const nextPost = allPosts.find((p) => +p.data.id === currentPostID - 1)
---

<Layout title={post.data.title}>
  <header class="pt-[var(--nav-height)]">
    <div class="relative pb-[56.25%] h-0 rounded-xl overflow-hidden lsa no-repeat">
      <mux-player
        playback-id={post.data.gifs.hero}
        metadata-video-title={`Supervoid Work Page: ${post.data.title}`}
        accent-color="var(--color-magenta-900)"
        class="w-full"></mux-player>
      <h1
        data-page-title
        class="absolute left-1 bottom-1 z-50 mr-1 px-4 py-1 bg-magenta-900 text-xs md:text-base lg:text-s uppercase text-white rounded-full"
      >
        {post.data.title}
      </h1>
    </div>
  </header>

  <main>
    <section id="work-details" class="lsa no-repeat pt-4 pb-8">
      <div
        id="info-details"
        class="md:grid md:grid-cols-[250px,1fr] items-start justify-start gap-4 border-t-[1px] border-b-[1px] py-4 md:py-6 cursor-pointer"
      >
        <button id="title" class="flex items-center gap-3">
          <Icon
            data-info-icon
            name="tabler:plus"
            class="w-10 h-10 flex-shrink-0 bg-white text-black rounded-full p-2 hover:scale-105 active:scale-95 hover:bg-grey-100 transition duration-300"
          />
          <h2 class="px-4 py-1 bg-magenta-900 text-xs uppercase text-white rounded-full">info</h2>
        </button>

        <div id="info-content" class="overflow-hidden transition duration-300 mt-4 md:mt-0">
          {post.data.info.map((item: string) => <p class="mb-4" set:html={item} />)}
        </div>
      </div>

      {
        post.data.credits?.length ? (
          <div
            id="credits-details"
            class="md:grid md:grid-cols-[250px,1fr] items-start gap-4 border-b-[1px] py-6 cursor-pointer"
          >
            <button id="title" class="flex items-center gap-3">
              <Icon
                data-credits-icon
                name="tabler:plus"
                class="w-10 h-10 flex-shrink-0 bg-white text-black rounded-full p-2 rotate-45 hover:scale-105 active:scale-95 hover:bg-grey-100 transition duration-300"
              />
              <h2 class="px-4 py-1 bg-magenta-900 text-xs uppercase text-white rounded-full">
                credits
              </h2>
            </button>

            <div id="credits-content" class="opacity-0 h-0 overflow-hidden">
              {post.data.credits?.map((item: string) => (
                <div set:html={item} />
              ))}
            </div>
          </div>
        ) : null
      }
    </section>

    <section id="work-gifs" class="grid md:grid-cols-2 md:gap-x-10 gap-y-8 md:gap-y-12">
      {
        post.data.gifs.gallery.map((gif: string) => (
          <article class="relative pb-[56.25%] h-0 rounded-xl overflow-hidden lsa lsa-slide-up no-repeat">
            <mux-player
              playback-id={gif}
              metadata-video-title="Supervoid Work Page Gallery"
              accent-color="var(--color-magenta-900)"
              class="w-full"
              style="--controls: none;"
              loop
              muted
              autoplay
            />
          </article>
        ))
      }
    </section>

    <section
      id="pagination"
      class="pagination flex flex-col md:flex-row justify-between gap-4 pt-0 text-m"
    >
      {
        prevPost && (
          <a
            href={`/work/${prevPost.slug}`}
            class="flex items-center gap-4 mr-auto hover:text-white relative"
            title={prevPost.data.title}
          >
            <Icon name="left" class="size-20 flex-shrink-0" />
            <span>Previous</span>
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="148"
              height="120"
              viewBox="0 0 148 120"
              class="absolute right-0 top-0 size-20"
            >
              <g fill="none">
                <path
                  class="circle-path"
                  d="M128.15 25c.27.2.32.38.58.62.26.24.59.39.79.57.4.35.87.62 1.25 1a37.908 37.908 0 0 1 3.1 3.24c.088.086.168.18.24.28l.55.66a46.368 46.368 0 0 1 3.41 4.77l.37.63.13.2a60.284 60.284 0 0 1 2.82 5.77 47.005 47.005 0 0 1 1.81 6.14 39.31 39.31 0 0 1 1 8.84 54.153 54.153 0 0 1-.38 7.19l-.25 1.78-.21 1.49c-.08.52-.23 1-.35 1.54.91.3 1.89 0 2.78.33a49.391 49.391 0 0 0 .59-20 42.63 42.63 0 0 0-1.54-6l-.49-1.48a9.29 9.29 0 0 0-.56-1.44l-1.3-2.83a39.544 39.544 0 0 0-3.12-5.34c-.6-.84-1.2-1.68-1.84-2.49-.31-.41-.65-.8-1-1.2l-.37-.44c-.85-1-1.72-1.93-2.64-2.84a42.2 42.2 0 0 0-2.75-3.28 2.001 2.001 0 0 0-1-.5c-.36-.06-.4-.16-.58-.13-.265.093-.49.273-.64.51-.55.68-.95 2-.4 2.41m-1.38 72.71-.56.55c-.424.437-.875.848-1.35 1.23-1.09.88-2.34 2-3.21 2.62l-.74.51c-1.17.78-2.45 1.79-3.88 2.63a67.372 67.372 0 0 1-12.39 6.14c-2.15.87-4.38 1.51-6.58 2.21s-4.48 1.2-6.77 1.62A97.092 97.092 0 0 1 77.47 117c-4.662.277-9.337.277-14 0a108.089 108.089 0 0 1-19.38-2.72 81.226 81.226 0 0 1-16.46-5.79 50.805 50.805 0 0 1-14.07-9.89c-.92-1-1.75-1.91-2.53-2.84-.78-.93-1.5-1.86-2.15-2.91a29.38 29.38 0 0 1-2-3.42l-1-2L5 85c-.12-.38-.31-.77-.42-1.23l-.38-1.45-.41-1.57c-.12-.54-.19-1.1-.29-1.66l-.28-1.66c-.1-.54-.1-1.09-.16-1.61-.06-1-.21-2-.2-2.76a53.25 53.25 0 0 1 .24-7.2c.14-1.07.26-2.15.44-3.32s.45-2.4.8-3.81a68.14 68.14 0 0 1 19.8-32.92 70.508 70.508 0 0 1 8-6.47 102.937 102.937 0 0 1 13.52-8 70.78 70.78 0 0 1 13.55-5.25 92.14 92.14 0 0 1 26-3.43 87 87 0 0 1 10.23.83c.84.09 1.66.27 2.48.4.82.13 1.64.27 2.45.46l2.43.54 1.79.47c1.016.282 2.018.616 3 1 .576.265 1.167.495 1.77.69a25.444 25.444 0 0 1 4.23 1.76c.61.29 2.26.57 2.63.24.37-.33.19-.56.4-.77.48-.47 0-1.86-.93-2.22-.93-.36-1.88-.71-2.83-1-.95-.29-2-.8-3-1.06-.8-.21-1.67-.22-2.43-.5a8.727 8.727 0 0 0-1.24-.34l-.54-.16-.32-.1h-.2L104 2.48A82.13 82.13 0 0 0 78 .19a91.05 91.05 0 0 0-53.3 21.4 72.79 72.79 0 0 0-21 30.06A60.38 60.38 0 0 0 .56 63.89a48.06 48.06 0 0 0-.25 12.68 42.439 42.439 0 0 0 3.33 12.29 39.267 39.267 0 0 0 7 10.61c5.78 6.29 13.25 10.71 21 13.73A99.276 99.276 0 0 0 56 118.93a124.014 124.014 0 0 0 24.9.45 96.34 96.34 0 0 0 15.29-2.62 85.408 85.408 0 0 0 14.53-5c.48-.22 1-.43 1.53-.7l.25-.13a63.717 63.717 0 0 0 9-5.29A61.914 61.914 0 0 0 136 91.31c0-1.4-.24-3.12-1.06-3.48-.24.37-.46.74-.71 1.08l-.76 1-1.6 2.18a50.972 50.972 0 0 1-5.1 5.62"
                />
                <path
                  class="circle-path"
                  d="M131.13 27.23c.272.259.526.536.76.83.32.39.9 1.13 1.23 1.5.33.37.54.57.78.81l.18.19.09.1.48.57c.77.9 1.53 1.91 2.37 3.08a43.808 43.808 0 0 1 2.52 4.08c.71 1.43 1.36 2.89 2 4.34.48 1.53 1.07 3 1.46 4.57l.51 2.34.26 1.18c.08.39.1.79.15 1.19a48.911 48.911 0 0 1-1.31 19.14 53.828 53.828 0 0 1-3.57 9.53 70.666 70.666 0 0 1-8.49 13c-.8.91-1.49 1.87-2.32 2.68l-2.44 2.48a52.11 52.11 0 0 1-5.85 4.61l-1.35.93c-.46.3-.93.56-1.4.85-.94.55-1.86 1.14-2.81 1.67-1.94 1-3.84 2.07-5.86 2.91-2.02.84-4 1.66-6.09 2.46s-4.18 1.39-6.34 1.89a94.87 94.87 0 0 1-21.59 3 112.41 112.41 0 0 1-18-.68 12.857 12.857 0 0 1 3.23 2.57c4.854.49 9.731.72 14.61.69h.43c1.11 0 2.22-.07 3.36-.12a89.538 89.538 0 0 0 25.63-5 77.202 77.202 0 0 0 13.24-6.09 60.982 60.982 0 0 0 11.75-8.82l1.32-1.29.66-.64.61-.7 2.43-2.78a67.866 67.866 0 0 0 4.26-6 36.12 36.12 0 0 0 1.88-3.17c.56-1.09 1.18-2.15 1.7-3.26l1.48-3.37c.49-1.12.83-2.31 1.25-3.45a52.365 52.365 0 0 0 2.77-18.48 44.37 44.37 0 0 0-4.44-18 42.72 42.72 0 0 0-5.58-8.77l-.92-1.11-.27-.31-.54-.61c-.72-.8-1.47-1.59-2.24-2.35a4.2 4.2 0 0 1-1.99 1.81m-19.64-14.72a.932.932 0 0 1 .63-.85 1.49 1.49 0 0 1 1.48.23 25.448 25.448 0 0 0 3.76 1.89c.68.35 1.34.76 2 1.16.66.4 1.34.77 2 1.13 1 .51 2.15 1.54 3.27 1.79a2.107 2.107 0 0 1 1.66 2.19 1.735 1.735 0 0 1-.75 1.21c-.81.53-1.93-.16-2.62-.6-.69-.44-.94-1.15-1.66-1.61-.35-.22-.65-.53-1-.77-.61-.44-1.23-.84-1.87-1.24-.64-.4-1.25-.82-1.89-1.2-.64-.38-1.09-.89-1.67-1.3-.58-.41-1.35-.45-2-.8-.33-.25-1.33-.74-1.34-1.23m-3.96-3.89c.49.16 1.86.81 1.64 1.48a1.45 1.45 0 0 1-.7.68c-.422.272-.859.519-1.31.74a1.611 1.611 0 0 1-.74.2c-.67 0-1.24-.63-1.85-.86-1.09-.38-1.94-1.29-3-1.8s-2.28-.51-2.63-1.72a2.6 2.6 0 0 1 1.41-.48c2.3.43 4.59 1 6.87 1.66.105.027.209.06.31.1M92.54 4.66a2.54 2.54 0 0 1 1.27.57c.89.81.7 2.6-.73 2.48A10.58 10.58 0 0 1 90.83 7c-.53-.17-2.32-.9-1.68-1.56A5.49 5.49 0 0 1 92 4.63c.18-.007.361.003.54.03M81 5.21v-.08c-.16-1.4 2.23-2.23 3.22-1.36a1.81 1.81 0 0 1-.15 2.71c-.84.46-2.85-.21-3.07-1.27"
                />
              </g>
            </svg>
          </a>
        )
      }
      {
        nextPost && (
          <a
            href={`/work/${nextPost.slug}`}
            class="flex items-center gap-4 ml-auto hover:text-white relative"
            title={nextPost.data.title}
          >
            <span>Next</span>
            <Icon name="right" class="size-20 flex-shrink-0" />
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="148"
              height="120"
              viewBox="0 0 148 120"
              class="absolute left-0 top-0 size-20"
            >
              <g fill="none">
                <path
                  class="circle-path"
                  d="M128.15 25c.27.2.32.38.58.62.26.24.59.39.79.57.4.35.87.62 1.25 1a37.908 37.908 0 0 1 3.1 3.24c.088.086.168.18.24.28l.55.66a46.368 46.368 0 0 1 3.41 4.77l.37.63.13.2a60.284 60.284 0 0 1 2.82 5.77 47.005 47.005 0 0 1 1.81 6.14 39.31 39.31 0 0 1 1 8.84 54.153 54.153 0 0 1-.38 7.19l-.25 1.78-.21 1.49c-.08.52-.23 1-.35 1.54.91.3 1.89 0 2.78.33a49.391 49.391 0 0 0 .59-20 42.63 42.63 0 0 0-1.54-6l-.49-1.48a9.29 9.29 0 0 0-.56-1.44l-1.3-2.83a39.544 39.544 0 0 0-3.12-5.34c-.6-.84-1.2-1.68-1.84-2.49-.31-.41-.65-.8-1-1.2l-.37-.44c-.85-1-1.72-1.93-2.64-2.84a42.2 42.2 0 0 0-2.75-3.28 2.001 2.001 0 0 0-1-.5c-.36-.06-.4-.16-.58-.13-.265.093-.49.273-.64.51-.55.68-.95 2-.4 2.41m-1.38 72.71-.56.55c-.424.437-.875.848-1.35 1.23-1.09.88-2.34 2-3.21 2.62l-.74.51c-1.17.78-2.45 1.79-3.88 2.63a67.372 67.372 0 0 1-12.39 6.14c-2.15.87-4.38 1.51-6.58 2.21s-4.48 1.2-6.77 1.62A97.092 97.092 0 0 1 77.47 117c-4.662.277-9.337.277-14 0a108.089 108.089 0 0 1-19.38-2.72 81.226 81.226 0 0 1-16.46-5.79 50.805 50.805 0 0 1-14.07-9.89c-.92-1-1.75-1.91-2.53-2.84-.78-.93-1.5-1.86-2.15-2.91a29.38 29.38 0 0 1-2-3.42l-1-2L5 85c-.12-.38-.31-.77-.42-1.23l-.38-1.45-.41-1.57c-.12-.54-.19-1.1-.29-1.66l-.28-1.66c-.1-.54-.1-1.09-.16-1.61-.06-1-.21-2-.2-2.76a53.25 53.25 0 0 1 .24-7.2c.14-1.07.26-2.15.44-3.32s.45-2.4.8-3.81a68.14 68.14 0 0 1 19.8-32.92 70.508 70.508 0 0 1 8-6.47 102.937 102.937 0 0 1 13.52-8 70.78 70.78 0 0 1 13.55-5.25 92.14 92.14 0 0 1 26-3.43 87 87 0 0 1 10.23.83c.84.09 1.66.27 2.48.4.82.13 1.64.27 2.45.46l2.43.54 1.79.47c1.016.282 2.018.616 3 1 .576.265 1.167.495 1.77.69a25.444 25.444 0 0 1 4.23 1.76c.61.29 2.26.57 2.63.24.37-.33.19-.56.4-.77.48-.47 0-1.86-.93-2.22-.93-.36-1.88-.71-2.83-1-.95-.29-2-.8-3-1.06-.8-.21-1.67-.22-2.43-.5a8.727 8.727 0 0 0-1.24-.34l-.54-.16-.32-.1h-.2L104 2.48A82.13 82.13 0 0 0 78 .19a91.05 91.05 0 0 0-53.3 21.4 72.79 72.79 0 0 0-21 30.06A60.38 60.38 0 0 0 .56 63.89a48.06 48.06 0 0 0-.25 12.68 42.439 42.439 0 0 0 3.33 12.29 39.267 39.267 0 0 0 7 10.61c5.78 6.29 13.25 10.71 21 13.73A99.276 99.276 0 0 0 56 118.93a124.014 124.014 0 0 0 24.9.45 96.34 96.34 0 0 0 15.29-2.62 85.408 85.408 0 0 0 14.53-5c.48-.22 1-.43 1.53-.7l.25-.13a63.717 63.717 0 0 0 9-5.29A61.914 61.914 0 0 0 136 91.31c0-1.4-.24-3.12-1.06-3.48-.24.37-.46.74-.71 1.08l-.76 1-1.6 2.18a50.972 50.972 0 0 1-5.1 5.62"
                />
                <path
                  class="circle-path"
                  d="M131.13 27.23c.272.259.526.536.76.83.32.39.9 1.13 1.23 1.5.33.37.54.57.78.81l.18.19.09.1.48.57c.77.9 1.53 1.91 2.37 3.08a43.808 43.808 0 0 1 2.52 4.08c.71 1.43 1.36 2.89 2 4.34.48 1.53 1.07 3 1.46 4.57l.51 2.34.26 1.18c.08.39.1.79.15 1.19a48.911 48.911 0 0 1-1.31 19.14 53.828 53.828 0 0 1-3.57 9.53 70.666 70.666 0 0 1-8.49 13c-.8.91-1.49 1.87-2.32 2.68l-2.44 2.48a52.11 52.11 0 0 1-5.85 4.61l-1.35.93c-.46.3-.93.56-1.4.85-.94.55-1.86 1.14-2.81 1.67-1.94 1-3.84 2.07-5.86 2.91-2.02.84-4 1.66-6.09 2.46s-4.18 1.39-6.34 1.89a94.87 94.87 0 0 1-21.59 3 112.41 112.41 0 0 1-18-.68 12.857 12.857 0 0 1 3.23 2.57c4.854.49 9.731.72 14.61.69h.43c1.11 0 2.22-.07 3.36-.12a89.538 89.538 0 0 0 25.63-5 77.202 77.202 0 0 0 13.24-6.09 60.982 60.982 0 0 0 11.75-8.82l1.32-1.29.66-.64.61-.7 2.43-2.78a67.866 67.866 0 0 0 4.26-6 36.12 36.12 0 0 0 1.88-3.17c.56-1.09 1.18-2.15 1.7-3.26l1.48-3.37c.49-1.12.83-2.31 1.25-3.45a52.365 52.365 0 0 0 2.77-18.48 44.37 44.37 0 0 0-4.44-18 42.72 42.72 0 0 0-5.58-8.77l-.92-1.11-.27-.31-.54-.61c-.72-.8-1.47-1.59-2.24-2.35a4.2 4.2 0 0 1-1.99 1.81m-19.64-14.72a.932.932 0 0 1 .63-.85 1.49 1.49 0 0 1 1.48.23 25.448 25.448 0 0 0 3.76 1.89c.68.35 1.34.76 2 1.16.66.4 1.34.77 2 1.13 1 .51 2.15 1.54 3.27 1.79a2.107 2.107 0 0 1 1.66 2.19 1.735 1.735 0 0 1-.75 1.21c-.81.53-1.93-.16-2.62-.6-.69-.44-.94-1.15-1.66-1.61-.35-.22-.65-.53-1-.77-.61-.44-1.23-.84-1.87-1.24-.64-.4-1.25-.82-1.89-1.2-.64-.38-1.09-.89-1.67-1.3-.58-.41-1.35-.45-2-.8-.33-.25-1.33-.74-1.34-1.23m-3.96-3.89c.49.16 1.86.81 1.64 1.48a1.45 1.45 0 0 1-.7.68c-.422.272-.859.519-1.31.74a1.611 1.611 0 0 1-.74.2c-.67 0-1.24-.63-1.85-.86-1.09-.38-1.94-1.29-3-1.8s-2.28-.51-2.63-1.72a2.6 2.6 0 0 1 1.41-.48c2.3.43 4.59 1 6.87 1.66.105.027.209.06.31.1M92.54 4.66a2.54 2.54 0 0 1 1.27.57c.89.81.7 2.6-.73 2.48A10.58 10.58 0 0 1 90.83 7c-.53-.17-2.32-.9-1.68-1.56A5.49 5.49 0 0 1 92 4.63c.18-.007.361.003.54.03M81 5.21v-.08c-.16-1.4 2.23-2.23 3.22-1.36a1.81 1.81 0 0 1-.15 2.71c-.84.46-2.85-.21-3.07-1.27"
                />
              </g>
            </svg>
          </a>
        )
      }
    </section>
  </main>
</Layout>

<style>
  .circle-path {
    stroke: var(--color-magenta-900);
    stroke-width: 4;
    stroke-dasharray: 1000;
    stroke-dashoffset: 1000;
    transition: stroke-dashoffset 0.5s ease-in-out;
  }

  .pagination a:hover .circle-path {
    stroke-dashoffset: 0;
  }
</style>

<script>
  const muxPlayer = document.querySelector(`mux-player`) as HTMLVideoElement
  const title = document.querySelector(`[data-page-title]`) as HTMLElement
  const infoDetails = document.querySelector(`#info-details`) as Element
  const infoContent = document.querySelector(`#info-content`) as HTMLElement
  const infoIcon = document.querySelector(`[data-info-icon]`) as Element
  const creditsDetails = document.querySelector(`#credits-details`) as Element
  const creditsContent = document.querySelector(`#credits-content`) as HTMLElement
  const creditsIcon = document.querySelector(`[data-credits-icon]`) as Element

  function handlePlayVideo() {
    title?.classList.add('hidden')
  }

  function handlePauseVideo() {
    title?.classList.remove('hidden')
  }

  function handleShowHideDetails(icon: Element, content: HTMLElement) {
    // icon styles
    icon.classList.toggle('rotate-45')

    // content styles
    content.classList.toggle('h-0')
    content.classList.toggle('opacity-0')
    content.classList.toggle('transition')
    content.classList.toggle('duration-300')
    content.classList.toggle('mt-4')
    content.classList.toggle('md:mt-0')
  }

  infoDetails!.addEventListener('click', () => handleShowHideDetails(infoIcon, infoContent))
  creditsDetails?.addEventListener('click', () =>
    handleShowHideDetails(creditsIcon, creditsContent)
  )
  muxPlayer.addEventListener('play', handlePlayVideo)
  muxPlayer.addEventListener('pause', handlePauseVideo)
</script>
